query GetCustomersWithMetadata($date: date) {
  customers: companies(
    where: { is_customer: { _eq: true } }
    order_by: { name: asc }
  ) {
    id
    ...CustomerForBank
    contract {
      id
      ...Contract
    }
    financial_summaries(where: { date: { _eq: $date } }) {
      id
      ...FinancialSummary
    }
    settings {
      id
      ...CompanySettings
    }
    ebba_applications(
      limit: 1, 
      order_by: [ 
        { 
          application_date: desc 
        }, 
        { 
          created_at: desc 
        } 
      ],
      where: {status: {_eq: approved}}
    ) {
      id
      ...EbbaApplication
    }
  }
}

query CompanyVendors($companyId: uuid!) {
  company_vendor_partnerships(where: { company_id: { _eq: $companyId } }) {
    vendor {
      name
    }
  }
}

query GetCompaniesWithMetadata {
  companies(
    order_by: { name: asc }
  ) {
    id
    ...Company
    contract {
      id
      ...Contract
    }
    settings {
      id
      ...CompanySettings
    }
  }
}
