query GetCustomersWithMetadata($date: date) {
  customers: companies(
    where: { is_customer: { _eq: true } }
    order_by: { name: asc }
  ) {
    ...CustomersWithMetadata
  }
}

query GetNonDummyCustomersWithMetadata(
  $date: date
  $start_date: date
  $end_date: date
) {
  customers: companies(
    where: {
      _and: [
        {
          _or: [
            { settings: { is_dummy_account: { _is_null: true } } }
            { settings: { is_dummy_account: { _eq: false } } }
          ]
        }
        { is_customer: { _eq: true } }
      ]
    }
    order_by: { name: asc }
  ) {
    ...CustomersWithMetadata
    loans(
      where: {
        _and: [
          {
            _or: [
              { is_deleted: { _is_null: true } }
              { is_deleted: { _eq: false } }
            ]
          }
          { funded_at: { _is_null: true } }
          { closed_at: { _is_null: true } }
          { requested_at: { _is_null: false } }
        ]
      }
    ) {
      status
      amount
    }
    customer_surveillance_results(
      limit: 1
      where: {
        _and: [
          { qualifying_date: { _gte: $start_date } }
          { qualifying_date: { _lte: $end_date } }
        ]
      }
    ) {
      ...CustomerSurveillanceResult
    }
  }
}

query GetCustomerSurveillanceResultsByDate(
  $company_id: uuid!
  $start_date: date
  $end_date: date
  $limit: Int
) {
  customer_surveillance_results(
    limit: $limit
    where: {
      _and: [
        { qualifying_date: { _gte: $start_date } }
        { qualifying_date: { _lte: $end_date } }
        { company_id: { _eq: $company_id } }
      ]
    }
  ) {
    ...CustomerSurveillanceResult
  }
}

query GetCustomersForDropdown {
  customers: companies(
    where: { is_customer: { _eq: true } }
    order_by: { name: asc }
  ) {
    id
    ...CustomerForBank
  }
}

query CompanyVendors($companyId: uuid!) {
  company_vendor_partnerships(where: { company_id: { _eq: $companyId } }) {
    vendor {
      name
    }
  }
}

query GetCompaniesWithMetadata {
  companies(order_by: { name: asc }) {
    id
    ...Company
    contract {
      id
      ...Contract
    }
    settings {
      id
      ...CompanySettings
    }
  }
}
