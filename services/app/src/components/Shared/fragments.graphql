#
# This file is for shared fragments used by Bank, Customer, and Vendor roles.
# When updating Fragments in this section, be careful not to include fields
# that a user cannot see, as this will result in their queries returning null.

## Users

fragment User on users {
  id
  first_name
  last_name
  full_name
  email
  phone_number
  role
  created_at
}

## Companies

# A company agreement can also correspond to an agreement that a vendor signs with Bespoke as well
fragment CompanyAgreement on company_agreements {
  id
  company_id
  file_id
}

# A company license is a license that corresponds to licenses for a customer or a vendor
fragment CompanyLicense on company_licenses {
  id
  company_id
  file_id
}

fragment Company on companies {
  id
  identifier
  name
  dba_name
  employer_identification_number
  address
  phone_number
}

fragment Contract on contracts {
  id
  company_id
  product_type
  product_config
  start_date
  end_date
  adjusted_end_date
}

## Purchase Order Financing

fragment VendorPartnership on company_vendor_partnerships {
  id
  company_id
  vendor_id
  vendor_agreement_id
  vendor_license_id
  approved_at
}

fragment PurchaseOrder on purchase_orders {
  id
  company_id
  vendor_id
  order_number
  order_date
  delivery_date
  amount
  is_cannabis
  status
  created_at
  funded_at
  company {
    id
    name
  }
  vendor {
    id
    name
  }
}

fragment LoanLimited on loans {
  id
  loan_type
  artifact_id
  identifier
  status
  payment_status
  amount
  requested_payment_date
  origination_date
  maturity_date
  adjusted_maturity_date
  outstanding_principal_balance
  outstanding_interest
  outstanding_fees
  approved_at
  funded_at
  company {
    id
    identifier
  }
}

## Files

fragment File on files {
  id
  name
  path
}

fragment PurchaseOrderFile on purchase_order_files {
  purchase_order_id
  file_id
  file_type
  file {
    id
    ...File
  }
}

## Finances

# Bank accounts can be stored for the Bespoke bank and for customers
fragment BankAccount on bank_accounts {
  id
  company_id
  bank_name
  bank_address
  account_title
  account_type
  account_number
  routing_number
  can_ach
  can_wire
  recipient_name
  recipient_address
  verified_at
  verified_date
  is_cannabis_compliant
}

fragment BankAccountForVendor on bank_accounts {
  id
  company_id
  bank_name
  bank_address
  account_title
  account_type
  account_number
  routing_number
  recipient_name
  recipient_address
}

fragment EbbaApplication on ebba_applications {
  id
  company_id
  application_date
  monthly_accounts_receivable
  monthly_inventory
  monthly_cash
  calculated_borrowing_base
  status
  rejection_note
  created_at
  expires_at
}

fragment EbbaApplicationFile on ebba_application_files {
  ebba_application_id
  file_id
  file {
    id
    ...File
  }
}

fragment LineOfCredit on line_of_credits {
  id
  company_id
  is_credit_for_vendor
  recipient_vendor_id
  recipient_vendor {
    id
    name
  }
}

fragment FinancialSummary on financial_summaries {
  id
  total_limit
  adjusted_total_limit
  total_outstanding_principal
  total_outstanding_interest
  total_outstanding_fees
  total_principal_in_requested_state
  available_limit
}
