#
# This file is for shared fragments used by Bank, Customer, and Vendor roles.
# When updating Fragments in this section, be careful not to include fields
# that a user cannot see, as this will result in their queries returning null.

## Users

fragment User on users {
  id
  first_name
  last_name
  full_name
  email
  phone_number
  role
  created_at
}

## Companies

# A company agreement can also correspond to an agreement that a vendor signs with Bespoke as well
fragment CompanyAgreement on company_agreements {
  id
  company_id
  file_id
}

# A company license is a license that corresponds to licenses for a customer or a vendor
fragment CompanyLicense on company_licenses {
  id
  company_id
  file_id
  license_number
}

fragment CompanyMinimal on companies {
  id
  name
  dba_name
}

fragment Company on companies {
  id
  identifier
  name
  contract_name
  dba_name
  employer_identification_number
  address
  phone_number
}

fragment Contract on contracts {
  id
  company_id
  product_type
  product_config
  start_date
  end_date
  adjusted_end_date
  terminated_at
}

## Files

fragment File on files {
  id
  name
  path
}

fragment PurchaseOrderFile on purchase_order_files {
  purchase_order_id
  file_id
  file_type
  file {
    id
    ...File
  }
}

## Finances

# Bank accounts can be stored for the Bespoke bank and for customers
fragment BankAccount on bank_accounts {
  id
  company_id
  bank_name
  bank_address
  account_title
  account_type
  account_number
  routing_number
  can_ach
  can_wire
  recipient_name
  recipient_address
  verified_at
  verified_date
  is_cannabis_compliant
}

fragment BankAccountForVendor on bank_accounts {
  id
  company_id
  bank_name
  bank_address
  account_title
  account_type
  account_number
  routing_number
  recipient_name
  recipient_address
}

fragment EbbaApplication on ebba_applications {
  id
  company_id
  application_date
  monthly_accounts_receivable
  monthly_inventory
  monthly_cash
  amount_cash_in_daca
  calculated_borrowing_base
  status
  rejection_note
  created_at
  expires_at
  submitted_by_user {
    id
    full_name
  }
}

fragment EbbaApplicationFile on ebba_application_files {
  ebba_application_id
  file_id
  file {
    id
    ...File
  }
}

fragment LineOfCredit on line_of_credits {
  id
  company_id
  is_credit_for_vendor
  recipient_vendor_id
  recipient_vendor {
    id
    name
  }
}

fragment FinancialSummary on financial_summaries {
  id
  company_id
  date
  available_limit
  adjusted_total_limit
  total_outstanding_principal
  total_outstanding_interest
  total_outstanding_fees
  total_principal_in_requested_state
  total_outstanding_principal_for_interest
  minimum_monthly_payload
  account_level_balance_payload
  day_volume_threshold_met
  interest_accrued_today
}

fragment InvoiceFile on invoice_files {
  invoice_id
  file_id
  file_type
  file {
    id
    ...File
  }
}

fragment Invoice on invoices {
  id
  company_id
  payor_id
  invoice_number
  subtotal_amount
  total_amount
  taxes_amount
  invoice_date
  invoice_due_date
  is_cannabis
  status
  created_at
  approved_at
  funded_at
  payment_requested_at
  payment_confirmed_at
  payment_rejected_at
  company {
    id
    name
  }
  payor {
    id
    name
  }
}

fragment VendorPartnership on company_vendor_partnerships {
  id
  company_id
  vendor_id
  vendor_bank_id
  vendor_agreement_id
  approved_at
  company {
    id
    name
  }
  vendor {
    id
    name
  }
}

fragment PayorPartnership on company_payor_partnerships {
  id
  company_id
  payor_id
  payor_agreement_id
  approved_at
  company {
    id
    name
  }
  payor {
    id
    name
  }
}

fragment MetrcTransfer on metrc_transfers {
  id
  company_id
  license_id
  delivery_id
  vendor_id
  transfer_type
  created_date
  manifest_number
  transfer_payload
  lab_results_status
  vendor {
    id
    name
  }
}

fragment MetrcPackage on metrc_packages {
  id
  package_id
  transfer_id
  delivery_id
  label
  type
  product_name
  package_payload
  lab_results_payload
  lab_results_status
  metrc_transfer {
    id
    manifest_number
  }
}

fragment PurchaseOrderMetrcTransfer on purchase_order_metrc_transfers {
  id
  purchase_order_id
  metrc_transfer_id
}
