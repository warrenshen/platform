subscription GetLatestBankFinancialSummaries {
  bank_financial_summaries(limit: 4, order_by: { date: desc }) {
    id
    updated_at
    date
    product_type
    adjusted_total_limit
    total_outstanding_principal
    total_outstanding_interest
    total_outstanding_fees
    total_principal_in_requested_state
    available_limit
  }
}

query GetCompanyWithActiveContract($companyId: uuid!) {
  companies_by_pk(id: $companyId) {
    id
    contract {
      id
      ...Contract
    }
  }
}

query GetCompanyForCustomerBorrowingBase($companyId: uuid!) {
  companies_by_pk(id: $companyId) {
    id
    ebba_applications(
      order_by: [{ application_date: desc }, { created_at: desc }]
    ) {
      id
      ...EbbaApplication
      company {
        id
        name
      }
    }
    settings {
      id
      active_ebba_application {
        id
        ...EbbaApplication
      }
    }
  }
}

query GetCompanyForCustomerContractPage($companyId: uuid!) {
  companies_by_pk(id: $companyId) {
    id
    contract {
      id
      ...Contract
    }
    contracts(order_by: [{ adjusted_end_date: desc }]) {
      id
      ...Contract
    }
  }
}

# Query is used to determine what navigation options to show in sidebar.
query GetCompanyWithDetailsByCompanyId($companyId: uuid!) {
  companies_by_pk(id: $companyId) {
    id
    name
    contract {
      id
      ...Contract
    }
    financial_summaries(order_by: { date: desc }, limit: 1) {
      id
      ...FinancialSummary
    }
  }
}

mutation GetCompanyNextLoanIdentifier(
  $companyId: uuid!
  $increment: companies_inc_input!
) {
  update_companies_by_pk(pk_columns: { id: $companyId }, _inc: $increment) {
    id
    latest_loan_identifier
  }
}
