query GetCompanyForCustomerOverview($companyId: uuid!) {
  companies_by_pk(id: $companyId) {
    id
    contract {
      id
      product_type
      product_config
    }
    financial_summary {
      id
      total_limit
      total_outstanding_principal
      total_outstanding_interest
      total_outstanding_fees
      total_principal_in_requested_state
      available_limit
    }
  }
}

query GetCompanyForCustomerBorrowingBase($companyId: uuid!) {
  companies_by_pk(id: $companyId) {
    id
    contract {
      id
      ...Contract
    }
    ebba_applications(
      order_by: [{ application_month: desc }, { created_at: desc }]
    ) {
      id
      ...EbbaApplication
      company {
        id
        name
      }
    }
    financial_summary {
      id
      total_limit
      total_outstanding_principal
      total_outstanding_interest
      total_outstanding_fees
      total_principal_in_requested_state
      available_limit
    }
    settings {
      id
      active_ebba_application {
        id
        ...EbbaApplication
      }
    }
  }
}

query GetLatestBankFinancialSummaries {
  bank_financial_summaries(limit: 4, order_by: { date: desc }) {
    id
    date
    product_type
    total_limit
    total_outstanding_principal
    total_outstanding_interest
    total_outstanding_fees
    total_principal_in_requested_state
    available_limit
  }
}

# Query is used to determine what navigation options to show in sidebar.
query CompanyWithDetailsByCompanyId($companyId: uuid!) {
  companies_by_pk(id: $companyId) {
    id
    contract {
      id
      ...Contract
    }
  }
}

mutation GetCompanyNextLoanIdentifier(
  $companyId: uuid!
  $increment: companies_inc_input!
) {
  update_companies_by_pk(pk_columns: { id: $companyId }, _inc: $increment) {
    id
    latest_loan_identifier
  }
}
