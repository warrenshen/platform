#
# This file is for fragments used by users on the Bank side
#   - Generally speaking, the bank can query nearly all fields

## Users

fragment Contact on users {
  id
  company_id
  full_name
  first_name
  last_name
  email
  phone_number
  created_at
}

## Companies

fragment CustomerForBank on companies {
  id
  identifier
  name
  contract_name
  employer_identification_number
  dba_name
  address
  country
  state
  city
  zip_code
  phone_number
}

fragment CompanySettings on company_settings {
  id
  company_id
  vendor_agreement_docusign_template
  payor_agreement_docusign_template
  collections_bespoke_bank_account_id
  has_autofinancing
  two_factor_message_method
}

fragment MetrcApiKey on metrc_api_keys {
  id
  created_at
  last_used_at
  is_functioning
  status_codes_payload
}

## Purchase Order Financing

fragment Vendor on companies {
  id
  name
  address
  country
  state
  city
  zip_code
  phone_number
}

fragment Loan on loans {
  id
  loan_type
  artifact_id
  identifier
  disbursement_identifier
  status
  rejection_note
  notes
  payment_status
  amount
  requested_payment_date
  origination_date
  maturity_date
  adjusted_maturity_date
  outstanding_principal_balance
  outstanding_interest
  outstanding_fees
  requested_at
  rejected_at
  funded_at
  closed_at
  company {
    id
    identifier
    name
  }
}

# The core fields for when the artifact related to a loan is shown.
fragment LoanArtifactLimited on loans {
  id
  loan_type
  artifact_id
  identifier
  invoice {
    id
    invoice_number
    payor {
      id
      name
    }
  }
  line_of_credit {
    id
    ...LineOfCredit
  }
  purchase_order {
    id
    order_number
    vendor {
      id
      name
    }
  }
}

fragment LoanArtifact on loans {
  id
  loan_type
  artifact_id
  identifier
  invoice {
    id
    ...Invoice
  }
  line_of_credit {
    id
    ...LineOfCredit
  }
  purchase_order {
    id
    ...PurchaseOrder
  }
}

## Invoices

fragment ThirdParty on companies {
  id
  name
  address
  country
  state
  city
  zip_code
  phone_number
}

fragment BankPayor on payors {
  id
  name
  address
  country
  state
  city
  zip_code
  phone_number
}

fragment PartnershipRequest on company_partnership_requests {
  id
  requesting_company_id
  two_factor_message_method
  company_type
  company_name
  license_info
  is_cannabis
  user_info
  created_at
  requested_by_user_id
  settled_by_user_id
  settled_at
}

## Finance

fragment Payment on payments {
  id
  company_id
  created_at
  submitted_at
  settled_at
  reversed_at
  type
  method
  requested_amount
  amount
  requested_payment_date
  payment_date
  deposit_date
  settlement_date
  items_covered
  is_deleted
  company_bank_account {
    ...BankAccount
  }
  submitted_by_user {
    id
    full_name
  }
}

fragment Transaction on transactions {
  id
  created_at
  loan_id
  payment_id
  type
  subtype
  amount
  effective_date
  to_principal
  to_interest
  to_fees
}
