subscription GetOpenLoansByDebtFacilityStatuses($statuses: [String!]) {
  loans ( where: {
    _and: [
      { loan_report: { debt_facility_status: { _in: $statuses } } },
      {
        _or: [
          { is_deleted: { _is_null: true } },
          { is_deleted: { _eq: false } }
        ]
      },
      { closed_at: { _is_null: true } }
    ]
  }) {
    id
    ...LoanForDebtFacility
    loan_report {
      id
      ...LoanReport
    }
    purchase_order {
      id
      ...PurchaseOrderForDebtFacility
    }
    invoice {
      id
      ...Invoice
    }
    transactions ( where: {
      _and: [
        { type: { _eq: "advance"} },
        # This was the date requested by the finance team w.r.t. CoVenture
        { effective_date: { _gt: "2021-11-24" }}
      ]
    }) {
      id
    }
  }
}

subscription GetDebtFacilityCapacity {
  debt_facility_capacities (
    order_by: [{ changed_at: desc }]
  ) {
    id
    ...DebtFacilityCapacityLimited
    debt_facility {
      id
      ...DebtFacilityLimited
    }
  }
}

subscription GetDebtFacilities {
  debt_facilities (
    order_by: [{ name: desc }]
  ) {
    id
    ...DebtFacilityLimited
    debt_facility_capacities {
      id
      ...DebtFacilityCapacityLimited
    }
  }
}

subscription  GetDebtFacilityCurrentCapacities {
  debt_facilities {
    id
    ...DebtFacilityLimited
    debt_facility_capacities (
      order_by: [{ changed_at: desc }],
      limit: 1,
    ) {
      id
      ...DebtFacilityCapacityLimited

    }
  }
}
