query GetEbbaApplicationsByCompanyId($company_id: uuid!, $category: String!) {
  ebba_applications(
    where: {
      _and: [
        {
          _or: [
            { is_deleted: { _is_null: true } }
            { is_deleted: { _eq: false } }
          ]
        }
        { company_id: { _eq: $company_id } }
        { category: { _eq: $category } }
      ]
    }
    order_by: [{ application_date: desc }, { created_at: desc }]
  ) {
    id
    ...EbbaApplication
    company {
      id
      name
      contract {
        id
        product_type
      }
    }
  }
}

subscription GetOpenEbbaApplicationsCountForBank {
  ebba_applications(
    where: {
      _and: [
        {
          _or: [
            { is_deleted: { _is_null: true } }
            { is_deleted: { _eq: false } }
          ]
        }
        { approved_at: { _is_null: true } }
      ]
    }
  ) {
    id
    category
  }
}

query GetOpenEbbaApplicationsByCategory($category: String!) {
  ebba_applications(
    where: {
      _and: [
        {
          _or: [
            { is_deleted: { _is_null: true } }
            { is_deleted: { _eq: false } }
          ]
        }
        { category: { _eq: $category } }
        { approved_at: { _is_null: true } }
      ]
    }
    order_by: [{ application_date: desc }, { created_at: desc }]
  ) {
    id
    ...EbbaApplication
    company {
      id
      name
      contract {
        id
        product_type
      }
    }
    ebba_application_files {
      ebba_application_id
      file_id
    }
  }
}

query GetClosedEbbaApplications {
  ebba_applications(
    where: {
      _and: [
        {
          _or: [
            { is_deleted: { _is_null: true } }
            { is_deleted: { _eq: false } }
          ]
        }
        { approved_at: { _is_null: false } }
      ]
    }
    order_by: [{ application_date: desc }, { created_at: desc }]
  ) {
    id
    ...EbbaApplication
    company {
      id
      name
      contract {
        id
        product_type
      }
    }
    ebba_application_files {
      ebba_application_id
      file_id
    }
  }
}
