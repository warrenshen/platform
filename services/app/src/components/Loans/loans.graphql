subscription GetLoansForBank {
  loans {
    id
    ...Loan
    ...LoanArtifactLimited
    company {
      id
      name
    }
  }
}

subscription GetNotFundedLoansForBank {
  loans(
    where: {
      _and: [
        { funded_at: { _is_null: true } }
        { closed_at: { _is_null: true } }
      ]
    }
    order_by: { requested_payment_date: asc }
  ) {
    id
    ...Loan
    ...LoanArtifactLimited
  }
}

subscription GetFundedLoansForBank {
  loans(
    where: {
      _and: [
        { funded_at: { _is_null: false } }
        { closed_at: { _is_null: true } }
      ]
    }
  ) {
    id
    ...Loan
    ...LoanArtifactLimited
  }
}

query GetActiveLoansForCompany($companyId: uuid!, $loanType: loan_type_enum) {
  companies_by_pk(id: $companyId) {
    id
    financial_summaries(
      order_by: { date: desc }
      where: { date: { _is_null: false } }
      limit: 1
    ) {
      id
      ...FinancialSummary
    }
    loans(
      where: {
        _and: [
          { loan_type: { _eq: $loanType } }
          { closed_at: { _is_null: true } }
          { rejected_at: { _is_null: true } }
        ]
      }
      order_by: { adjusted_maturity_date: asc }
    ) {
      id
      ...LoanLimited
      ...LoanArtifactLimited
    }
  }
}

query GetFundedLoansForCompany($companyId: uuid!, $loanType: loan_type_enum!) {
  loans(
    where: {
      _and: [
        { company_id: { _eq: $companyId } }
        { loan_type: { _eq: $loanType } }
        { funded_at: { _is_null: false } }
        { rejected_at: { _is_null: true } }
        { closed_at: { _is_null: true } }
      ]
    }
    order_by: { adjusted_maturity_date: asc }
  ) {
    id
    ...LoanLimited
    ...LoanArtifactLimited
  }
}

query GetClosedLoansForCompany($companyId: uuid!, $loanType: loan_type_enum) {
  companies_by_pk(id: $companyId) {
    id
    loans(
      where: {
        _and: [
          { closed_at: { _is_null: false } }
          { loan_type: { _eq: $loanType } }
        ]
      }
      order_by: { adjusted_maturity_date: asc }
    ) {
      id
      ...LoanLimited
      ...LoanArtifactLimited
    }
  }
}

query LoansByCompanyAndLoanTypeForBank(
  $companyId: uuid!
  $loanType: loan_type_enum
) {
  loans(
    where: {
      _and: [
        { company_id: { _eq: $companyId } }
        { loan_type: { _eq: $loanType } }
      ]
    }
    order_by: { adjusted_maturity_date: asc }
  ) {
    id
    ...Loan
    ...LoanArtifactLimited
  }
}

query GetLoansByLoanIds($loanIds: [uuid!]) {
  loans(where: { id: { _in: $loanIds } }) {
    id
    ...Loan
  }
}
