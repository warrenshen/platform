## Fragments

fragment Vendor on companies {
  id
  name
  address
  country
  state
  city
  zip_code
  phone_number
}

fragment BankVendorPartnership on company_vendor_partnerships {
  id
  company_id
  vendor_id
  vendor_agreement_id
  vendor_bank_account {
    ...BankAccount
  }
  vendor_license_id
  approved_at
}

# Full list of fields you can query for company settings
fragment CompanySettings on company_settings {
  id
  company_id
  vendor_agreement_docusign_template
  collections_bespoke_bank_account_id
  advances_bespoke_bank_account_id
  product_type
  product_config
}

# A company agreement can also correspond to an agreement that a vendor signs with Bespoke as well
fragment CompanyAgreement on company_agreements {
  id
  company_id
  file_id
}

# A company license is a license that corresponds to licenses for a customer or a vendor
fragment CompanyLicense on company_licenses {
  id
  company_id
  file_id
}

fragment BankAccount on bank_accounts {
  id
  company_id
  bank_name
  bank_address
  account_type
  account_number
  routing_number
  can_ach
  can_wire
  recipient_name
  recipient_address
  verified_at
}

## Queries

query BankListVendorPartnerships {
  company_vendor_partnerships {
    ...BankVendorPartnership
    vendor {
      ...Vendor
      settings {
        id
      }
      users {
        ...Contact
      }
    }
  }
}

query BankVendorPartnership($id: uuid!) {
  company_vendor_partnerships_by_pk(id: $id) {
    ...BankVendorPartnership
    vendor {
      ...Vendor
      settings {
        id
      }
      users {
        ...Contact
      }
      settings {
        collections_bespoke_bank_account {
          ...BankAccount
        }
        advances_bespoke_bank_account {
          ...BankAccount
        }      
      }
    }
    company {
      ...Company
      users {
        ...Contact
      }
    }
    company_agreement {
      ...CompanyAgreement
    }
    company_license {
      ...CompanyLicense
    }
  }
}

query CompanyBankAccounts($companyId: uuid!) {
  bank_accounts(where: { company_id: { _eq: $companyId } }) {
    ...BankAccount
  }
}

## Bank account mutations

mutation AddBankAccount($bankAccount: bank_accounts_insert_input!) {
  insert_bank_accounts_one(object: $bankAccount) {
    ...BankAccount
  }
}

mutation UpdateBankAccount($id: uuid!, $bankAccount: bank_accounts_set_input) {
  update_bank_accounts_by_pk(pk_columns: { id: $id }, _set: $bankAccount) {
    ...BankAccount
  }
}

mutation ChangeBankAccount(
  $companyVendorPartnershipId: uuid!
  $bankAccountId: uuid
) {
  update_company_vendor_partnerships_by_pk(
    pk_columns: { id: $companyVendorPartnershipId }
    _set: { vendor_bank_id: $bankAccountId }
  ) {
    id
    vendor_bank_account {
      ...BankAccount
    }
  }
}

## Misc mutations on company_vendor_partnerships

mutation UpdateCompanyVendorPartnershipApprovedAt(
  $companyVendorPartnershipId: uuid!
  $approvedAt: timestamptz
) {
  update_company_vendor_partnerships_by_pk(
    pk_columns: { id: $companyVendorPartnershipId }
    _set: { approved_at: $approvedAt }
  ) {
    ...BankVendorPartnership
  }
}

## Misc mutations on vendor

mutation UpdateVendorInfo($id: uuid!, $company: companies_set_input!) {
  update_companies_by_pk(pk_columns: { id: $id }, _set: $company) {
    ...Vendor
  }
}

## Agreement mutations

mutation UpdateVendorAgreementId(
  $companyVendorPartnershipId: uuid!
  $vendorAgreementId: uuid
) {
  update_company_vendor_partnerships_by_pk(
    pk_columns: { id: $companyVendorPartnershipId }
    _set: { vendor_agreement_id: $vendorAgreementId }
  ) {
    id
    company_agreement {
      ...CompanyAgreement
    }
  }
}

mutation AddCompanyVendorAgreement(
  $vendorAgreement: company_agreements_insert_input!
) {
  insert_company_agreements_one(object: $vendorAgreement) {
    ...CompanyAgreement
  }
}

## License mutations

mutation UpdateVendorLicenseId(
  $companyVendorPartnershipId: uuid!
  $vendorLicenseId: uuid!
) {
  update_company_vendor_partnerships_by_pk(
    pk_columns: { id: $companyVendorPartnershipId }
    _set: { vendor_license_id: $vendorLicenseId }
  ) {
    id
    company_license {
      ...CompanyLicense
    }
  }
}

mutation AddCompanyVendorLicense(
  $vendorLicense: company_licenses_insert_input!
) {
  insert_company_licenses_one(object: $vendorLicense) {
    ...CompanyLicense
  }
}
